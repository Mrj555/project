<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="/stylesheets/list.css" />
		<script type="text/javascript" src="/js/jquery.min.js"></script>
			
		
	</head>
	<body>
	<!---->
					<h1>
						<span class="action-span">
							<a href="#">添加新商品</a>
						</span>
						<span class="action-span1">
							<a href="#">ECSHOP 管理中心</a> 
						</span>
<span id="search_id" class="action-span1"> - 商品列表 </span>
<!-- 商品管理 -->
<span class="help_sub"><a target="_blank" title="商品列表帮助文档" href="#"><img src="../images/jnsy.png"></a></span>


					</h1>
			<!---->
			<div class="form-div">
				<img src="../images/icon_search.gif" alt="SEARCH" width="26" height="22" border="0">
				<!--分类-->
				<select name="cat_id">
					<option value="0" selected="selected">所有分类</option>
					<option value="132">钻石</option>
					<option value="190">&nbsp;&nbsp;&nbsp;&nbsp;衬衫</option>
					<option value="193">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;短袖衬衫</option>
					<option value="194">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;长袖衬衫</option>
					<option value="170">&nbsp;&nbsp;&nbsp;&nbsp;裤子</option>
					<option value="173">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;休闲裤</option>
					<option value="623">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;休闲短裤</option>
				</select>
				<!--品牌-->
				<select name="brand_id">
					<option value="0" selected="selected">所有品牌</option>
					<option value="44">kk</option>
					<option value="32">溢彩年华</option>
					<option value="31">EVENY</option>
					<option value="30">圣迪奥</option>
					<option value="29">韩都衣舍</option>
					<option value="28">betu百图</option>
					<option value="27">艾夫斯</option>
				</select>
				<!--推荐-->
				<select name="intro_type">
					<option value="0" selected="selected">全部</option>
					<option value="is_best">精品</option>
					<option value="is_new">新品</option>
					<option value="is_hot">热销</option>
					<option value="is_promote">特价</option>
					<option value="all_type">全部推荐</option>
				</select>
				<!--上架-->
				<select name="is_on_sale">
					<option value="" selected="selected">全部</option>
					<option value="1">上架</option>
					<option value="0">下架</option>
				</select>
				<!-- 关键字 -->
				关键字 <input name="keyword" size="15" type="text" id="keyword">
				<input value=" 搜索 " class="button" type="submit" id="search">
				<!--商品列表-->
			<div class="list-div" id="listDiv">
				<table cellspacing="1" cellpadding="3">
					<tbody>
						<tr>
							<th>
								<input type="checkbox">
								<a href="javascript:;">编号</a><img src="../images/sort_desc.gif"> </th>
							<th>
								<a href="javascript:;">商品名称</a>
							</th>
							<th>
								<a href="javascript:;">货号</a>
							</th>
							<th>
								<a href="javascript:;">价格</a>
							</th>
							<th>
								<a href="javascript:;">上架</a>
							</th>
							<th>
								<a href="javascript:;">精品</a>
							</th>
							<th>
								<a href="javascript:);">新品</a>
							</th>
							<th>
								<a href="javascript:;">热销</a>
							</th>
							<th>
								<a href="javascript:;">推荐排序</a>
							</th>
							<th>
								<a href="javascript:;">库存</a>
							</th>
							<th>
								<a href="javascript:;" title="点击对列表排序">虚拟销量</a>
							</th>
							<th>操作</th>
						</tr>
						<!---->
						
						<!---->
					</tbody>
				</table>
				<script>
					
				</script>
			</div>
			</div>
			<!-- 分页 -->
				<table id="page-table" cellspacing="0">
					<tbody>
						<tr>
							<td style="background-color: rgb(255, 255, 255);" nowrap="true" align="right">							
								<div id="turn-page">
									总计 <span id="totalRecords"></span> 个记录分为 <span id="totalPages"></span> 页当前第 <span id="pagenow">1</span> 页，每页 <input size="3" id="pageSize" value="5" onkeypress=" " type="text">
									<span id="page-link">
          <a href="javascript:;" onclick="first">第一页</a>
          <a href="javascript:;" onclick="last()">上一页</a>
          <a href="javascript:;" onclick="next()">下一页</a>
          <a href="javascript:;" onclick="end()">最末页</a>
          <select id="gotoPage" onclick="list()">
            <option value="1" selected="selected">1</option>          </select>
        </span>
								</div>
							</td>
						</tr>
					</tbody>
				</table>
				<!---->
				<div>				
				<select name="type" id="selAction" onchange="">
					<option value="" selected="selected">请选择...</option>
					<option value="trash">回收站</option>
					<option value="on_sale">上架</option>
					<option value="not_on_sale">下架</option>
					<option value="best">精品</option>
					<option value="not_best">取消精品</option>
					<option value="new">新品</option>
					<option value="not_new">取消新品</option>
					<option value="hot">热销</option>
					<option value="not_hot">取消热销</option>
					<option value="move_to">转移到分类</option>
				</select>
				<input name="extension_code" value="" type="hidden">
				<input value=" 确定 " id="btnSubmit" name="btnSubmit" class="button" disabled="true" type="submit">
			</div>
					<!---->
			<div id="footer">
			共执行 7 个查询，用时 0.022002 秒，Gzip 已禁用，内存占用 3.548 MB<br> 版权所有 © 2005-2018 上海商派软件有限公司，并保留所有权利。</div>
	</body>
</html>
<script type="text/javascript">
	/*总计*/
//console.log($(".shops").length)
var str = $(".shops").length;
$("#totalRecords").html(str);
	var str = $(".shops").length;
$("#num2").html(str);
changNum = function(){
	var str = $(".shops").length;
$("#totalRecords").html(str);
	var str = $(".shops").length;
$("#num2").html(str);
}


/*****************动态删除*******************/ 
		remove = function(obj){
			var goods_name = $(obj).parents().parents(".shops").children(".first-cell").text();
			console.log(goods_name)
			$.ajax({
				url : "/api/remove_goods",
				type : "post",
				data : {
					goods_name : goods_name
				},
				success : function(res){
					if(res.code == 1){
						$(obj).parents().parents(".shops").remove();
						alert("删除成功")
					}else{
						alert(res.message);
					}
				}
			}) 
		}


/************************************/
//clone = function(obj){
//	console.log($(obj).parent().parent().clone())
//	$(obj).parent().parent().clone().appendTo($(obj).parent().parent().parent())
//}


/******************列表编辑*********************/

changes = function(obj){
			$.ajax({
				url : "/api/change_goods",
				type : "post",
				data : {
					goods_name : goods_name
				},
				success : function(res){
					if(res.code == 1){
						$(obj).parents().parents(".shops").change();
						alert("修改成功")
					}else{
						alert(res.message);
					}
				}
			}) 
	
	
}

/***********************分页+生成商品信息*********************/
$(function(){
	 AppendStr();
	//点击下一页
	var pages = 1;
	var paged = "";
	function next () {
		var page = $("#pagenow").val();
		pages = Number(page)+1;
//		console.log(pages)
		$("#pagenow").val(pages);
		$(".shops").remove();
		AppendStr(pages);
	}
	function first () {
		pages = 1;
		$("#pagenow").val(pages);
		$(".shops").remove();
		AppendStr(pages);
	}
	function last () {
		var page = $("#pagenow").val();
		pages = Number(page)-1;
		$("#pagenow").val(pages);
		$(".shops").remove();
		AppendStr(pages);
	}
	function end () {
		pages = paged;
		$("#pagenow").val(pages);
		$(".shops").remove();
		AppendStr(pages);
	}
	console.log($("#pagenow").val(),$("#pageSize").val())
	function AppendStr (pages) {
		$.ajax({
	  		url: "/api/goods_msg",
	  		type: "post",
	  		data: {
	  			condition:1,
	  			pageNO:pages,
	  			perPageCnt:$("#pageSize").val()
	  		},
	  		success:function (res) {
//	  			console.log(res);
//	  			console.log(res.data);
	  			var data = res.data;	  			
	  			var len = data.length;	  		
	  			paged = Math.ceil(Number(res.total)/Number(res.perPageCnt));
	  			console.log(res)
	  			console.log(res.total,res.perPageCnt);
	  			$("#totalRecords").html(res.total);
	  			$("#totalPages").html(res.pageNO);
	  			$("#totalPages").html(paged);
	  			for(var i = 0;i < len;i ++){
						var goods_name = data[i].goods_name;						
						var price = data[i].price;						
						var obj = '<tr class="shops"><td><input name="checkboxes" value="143" type="checkbox">'+(i+1)+'</td><td class="first-cell"><span onclick="change(this,"act")" >'+goods_name+'</span></td><td align="center"><span onclick="change(this,"act")">ESC000234</span></td><td  align="center"><span onclick="change(this,"act")" title="点击修改内容" style="" id="shop_price">'+price+'</span></td><td align="center"><img src="../images/no.gif" onclick=""></td><td align="center"><img src="../images/yes.gif" onclick=""></td><td align="center"><img src="../images/no.gif" onclick=""></td><td align="center"><img src="../images/yes.gif" onclick=""></td><td align="center"><span onclick=" ">100</span></td><td align="center"><span onclick="">1</span></td><td align="center"><span onclick="#">222</span></td><td align="center"><a href="#"  title="查看"><img src="../images/icon_view.gif" width="21" height="21" border="0"></a><a href="add_goods" id="changes" target="content" onclick="mychange(this)" title="编辑"><img src="../images/icon_edit.gif" class="bianji" width="21" height="21" border="0"></a><a href="javascript:;" title="复制" onclick="add(this)"><img src="../images/icon_copy.gif" width="21" height="21" border="0"></a><a href="javascript:;" onclick="remove(this)" title="回收站"><img src="../images/icon_trash.gif" width="21" height="21" border="0"></a></td></tr>'
//						console.log(obj)
						$("#listDiv table tbody ").append(obj);
					}	
	  		}
		}) 
	}
})
/********************************************/
//change = function(obj, act){
//var tag = obj.firstChild.tagName;
//
//if (typeof(tag) != "undefined" && tag.toLowerCase() == "input"){
//	return;
//}
//}

//
//$("#listDiv table").delegate(".bianji", "click", function(){
//	console.log($(this).parent().parent().parent().find("td").eq(1))
//	
//	var uname = $(this).parents("tr").find("td").eq(1).find("span").html();
//	console.log(uname)
//	$.ajax({
//		type:"post",
//		url:"/api/update",
////		async:true,
//		data:{
//			uname:uname
//		},
//		success:function(res){
//			console.log(res)
//			var ushopname = encodeURIComponent(res[0].goods_name);			
//			var ushopprice = res[0].price;
//			window.location = "/add_goods?" + ushopname +"&"+ushopprice;
//		}
//	});
//})
mychange = function(obj){
	var obj = obj;
	var goods_name = $(obj).parents().children("#goods_name").text();
	console.log(goods_name);
	$.ajax({
		//url：'/api/goods_change',
		type:'POST',
		data:{
			goods_name :goods_name
		},
		success:function(res){
			var dat = res.data;
			$.ajax({
				type:"get",
				url:"/add_goods",
				success:function(ress){
					$.each(dat, function(index,value) {
						$(".list_r").html(ress);
						$("#goods_name").val(value.goods_name);
						$("#price").val(value.price);
					});
				}
			});
		}
	})
}

</script>
